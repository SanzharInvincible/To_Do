
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Tenebris</title>
<style>
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

body {
    background: #0f0b1e;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    color: white;
}

.app {
    width: 360px;
    height: 640px;
    background: #17122b;
    border-radius: 24px;
    padding: 20px;
    display: flex;
    flex-direction: column;
}

.screen {
    flex: 1;
    display: none;
    opacity: 0;
    transition: opacity 0.3s ease;
    overflow-y: auto;
}

.screen.active {
    display: flex;
    flex-direction: column;
    opacity: 1;
}

.header {
    font-size: 22px;
    font-weight: 600;
    margin-bottom: 20px;
}

.habit {
    background: #221b3d;
    border-radius: 16px;
    padding: 16px;
    margin-bottom: 14px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.check {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    border: 2px solid #7b6cff;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: all 0.2s ease;
}

.check.done {
    transform: scale(1.1);
    background: #7b6cff;
    border-color: #7b6cff;
}

#add-task-btn {
    margin-top: 10px;
    padding: 12px;
    width: 100%;
    background: #7b6cff;
    color: white;
    font-size: 16px;
    border: none;
    border-radius: 16px;
    cursor: pointer;
    transition: transform 0.2s ease;
}

#add-task-btn:hover {
    transform: scale(1.05);
}

#new-task-container {
    display: none;
    gap: 10px;
    margin-top: 10px;
    justify-content: space-between;
}

#new-task-container input {
    flex: 1;
    padding: 8px;
    border-radius: 12px;
    border: none;
}

#save-task-btn {
    padding: 8px 12px;
    border-radius: 12px;
    border: none;
    background: #7b6cff;
    color: white;
    cursor: pointer;
}

#chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-bottom: 10px;
    overflow-y: auto;
}

.message {
    padding: 10px 14px;
    border-radius: 12px;
    max-width: 85%;
    word-wrap: break-word;
    margin-bottom: 8px;
}

.message.user {
    background: #7b6cff;
    align-self: flex-end;
    text-align: right;
}

.message.ai {
    background: #221b3d;
    align-self: flex-start;
}

#ai-input-container {
    display: flex;
    gap: 10px;
}

#ai-message-input {
    flex: 1;
    padding: 10px;
    border-radius: 12px;
    border: none;
    background: #221b3d;
    color: white;
    font-size: 14px;
}

#ai-message-input::placeholder {
    color: #999;
}

#send-btn {
    padding: 10px 16px;
    border-radius: 12px;
    border: none;
    background: #7b6cff;
    color: white;
    cursor: pointer;
    transition: transform 0.2s ease;
}

#send-btn:hover {
    transform: scale(1.05);
}

.footer {
    display: flex;
    justify-content: space-around;
    padding-top: 10px;
    font-size: 12px;
    opacity: 0.8;
}

.footer div {
    cursor: pointer;
}

.footer .active {
    color: #7b6cff;
}
</style>

</head>

<body>

<div class="app">

    <div class="screen active" id="today">
        <div class="header">–°–µ–≥–æ–¥–Ω—è</div>

        <div id="habit-list">
            
        </div>

        <div id="new-task-container">
            <input type="text" id="new-task-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏">
            <button id="save-task-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
        </div>


        <button id="add-task-btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É</button>
    </div>

 

<div class="screen" id="stats">
    <div class="header">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ </div>
    <div id="stats-content" style="padding: 20px;">
        <div style="background: #221b3d; border-radius: 16px; padding: 20px; margin-bottom: 15px; text-align: center;">
            <div style="font-size: 14px; opacity: 0.8; margin-bottom: 10px;">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</div>
            <div style="font-size: 32px; font-weight: bold; color: #7b6cff;" id="total-tasks">0</div>
        </div>
        
        <div style="background: #221b3d; border-radius: 16px; padding: 20px; margin-bottom: 15px; text-align: center;">
            <div style="font-size: 14px; opacity: 0.8; margin-bottom: 10px;"> –í—ã–ø–æ–ª–Ω–µ–Ω–æ</div>
            <div style="font-size: 32px; font-weight: bold; color: #7b6cff;" id="completed-tasks">0</div>
        </div>
        
        <div style="background: #221b3d; border-radius: 16px; padding: 20px; margin-bottom: 15px; text-align: center;">
            <div style="font-size: 14px; opacity: 0.8; margin-bottom: 10px;"> –û—Å—Ç–∞–ª–æ—Å—å</div>
            <div style="font-size: 32px; font-weight: bold; color: #7b6cff;" id="remaining-tasks">0</div>
        </div>
        
        <div style="background: #221b3d; border-radius: 16px; padding: 20px; text-align: center;">
            <div style="font-size: 14px; opacity: 0.8; margin-bottom: 10px;">–ü—Ä–æ—Ü–µ–Ω—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</div>
            <div style="font-size: 32px; font-weight: bold; color: #7b6cff;" id="completion-percentage">0%</div>
        </div>
    </div>
</div>

    <div class="screen" id="ai-assistant">
        <div class="header">AI –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç </div>
        <div id="chat-container"></div>
        <div id="ai-input-container">
            <input type="text" id="ai-message-input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
            <button id="send-btn">/|\</button>
        </div>
    </div>

    <div class="screen" id="profile">
        <div class="header">–ü—Ä–æ—Ñ–∏–ª—å</div>
        <p>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è üë§</p>
    </div>

    <div class="footer">
        <div class="active" onclick="openScreen('today', this)">–°–µ–≥–æ–¥–Ω—è</div>
        <div onclick="openScreen('stats', this)">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</div>
        <div onclick="openScreen('ai-assistant', this)">AI</div>
        <div onclick="openScreen('profile', this)">–ü—Ä–æ—Ñ–∏–ª—å</div>
    </div>

</div>

<script>

function openScreen(screenId, button) {
    document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
    });

    document.getElementById(screenId).classList.add('active');

    document.querySelectorAll('.footer div').forEach(btn => {
        btn.classList.remove('active');
    });

    button.classList.add('active');
}

function toggleHabit(el) {
    el.classList.toggle('done');
}

const addBtn = document.getElementById('add-task-btn');
const newTaskContainer = document.getElementById('new-task-container');
const saveBtn = document.getElementById('save-task-btn');
const taskInput = document.getElementById('new-task-input');
const habitList = document.getElementById('habit-list');

addBtn.addEventListener('click', () => {
    newTaskContainer.style.display = 'flex';
    taskInput.focus();
});

saveBtn.addEventListener('click', () => {
    const taskName = taskInput.value.trim();
    if(taskName !== '') {
        const newHabit = document.createElement('div');
        newHabit.className = 'habit';
        newHabit.innerHTML = `
            <div>üÜï ${taskName}</div>
            <div class="check" onclick="toggleHabit(this)">‚úì</div>
        `;
        habitList.appendChild(newHabit);

        taskInput.value = '';
        newTaskContainer.style.display = 'none';
    }
});

function loadStats() {
    fetch('/stats')
        .then(response => response.json())
        .then(data => {
            document.getElementById('total-tasks').textContent = data.total;
            document.getElementById('completed-tasks').textContent = data.completed;
            document.getElementById('remaining-tasks').textContent = data.remaining;
            
            const percentage = data.total === 0 ? 0 : Math.round((data.completed / data.total) * 100);
            document.getElementById('completion-percentage').textContent = percentage + '%';
        });
}

async function updateTaskStatus(index, isDone) {
    try {
        await fetch(`/update-task/${index}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ done: isDone })
        });
        loadStats();
    } catch(error) {
        console.error('Error updating task:', error);
    }
}

document.addEventListener('DOMContentLoaded', loadStats);

const chatContainer = document.getElementById('chat-container');
const aiInput = document.getElementById('ai-message-input');
const sendBtn = document.getElementById('send-btn');

function addMessage(text, sender) {
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${sender}`;
    messageDiv.textContent = text;
    chatContainer.appendChild(messageDiv);
    chatContainer.scrollTop = chatContainer.scrollHeight;
}

async function sendMessage() {
    const message = aiInput.value.trim();
    if(message === '') return;

    addMessage(message, 'user');
    aiInput.value = '';

    try {
        const response = await fetch('/chat', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ message: message })
        });

        const data = await response.json();
        addMessage(data.reply, 'ai');
    } catch(error) {
        addMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞', 'ai');
        console.error('Error:', error);
    }
}

sendBtn.addEventListener('click', sendMessage);
aiInput.addEventListener('keypress', (e) => {
    if(e.key === 'Enter') {
        sendMessage();
    }
});
</script>

</body>
</html>